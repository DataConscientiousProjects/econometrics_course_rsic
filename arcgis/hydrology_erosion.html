<h3>Erosion modeling</h3>
<p>Resources:
<a href="http://www.lib.ncsu.edu/gis/virtcamp.html">ESRI virtual campus</a>


Task: Compute soil detachment and net erosion/deposition using simple GIS-based models

<p>
Create the assignment working directory (folder) .\Assign12.<br>
Start ArcMap:

<pre>
Start->Programs->ArcGIS->ArcMap
</pre>

<p>
Check out a Spatial Analyst Extension license.:

<pre>
Under Tools->Extensions make sure there is a check next to 'Spatial Analyst'
Select View->Toolbars->Spatial Analyst to activate the extension
</pre>

<h3>Compute soil detachment rate using RUSLE3d</h3>

Compute a map of soil detachment rate using RUSLE3d equation which assumes that there is no deposition.<br>
This represents detachment limited sediment transport by overland flow.<br>
<pre>
E = RKLSCP
</pre>
<p>where
<ul>
<li>E is the annual soil detachment rate (soil loss)</li>
<li>R is the rainfall</li>
<li>K is the soil</li>
<li>C is the land cover</li>
<li>P is the preventive measures factor</li>
<li>LS = 1.4 * (U/22.1)**0.4 * (sin (slope/0.09))**1.2<br>
LS is the topography factor, U is contributing area per unit width (function of flowaccumulation)</li>
</ul>
<p>
For units and explanation of constants see <a href="http://courses.ncsu.edu/mea582/common/GIS_anal_assign/erosion_notes2.pdf"><b>Erosion modeling notes</b></a><br>

<p>
First compute slope, and flowaccumulation for the elevation raster map e_lid792 (NOT elid_792):


<pre>
In ArcMap
Add the raster feature layer: ncrast.mdb/e_lid792  (NOT elid_792)
Open the ArcToolbox
</pre>

<p>
Compute slope_1m map using the Slope function, we will use it later:

<pre>
Select 'Spatial Analyst Tools->Surface->Slope'
Set 'Input' to 'e_lid792'
Set 'Output Raster Dataset' to '.\Assign12\slope_1m'
keep DEGREES for units
Click 'OK'
</pre>

<p>
Compute the flow accumulation map Flowacc:

<pre>
Compute Fill input=e_lid792 output=Fill_e_lid
Compute FlowDirection input=Fill_e_lid ouput=FlowDir_fil
Compute FlowAccumulation input=FlowDir_fil output=Flowacc
</pre>

<h4>LS factor</h4>
Build an expression in the Spatial Analyst Raster Calculator for lsfac map
using the Flowacc and slope_1m layers you just generated.<br>
<p>
Note that the lsfac map represents the topographic factor LS used in the RUSLE3d model.<br>
Flowacc map multiplied by resolution is the contributing area per unit width U.

<pre>
In the ArcToolbox, Select 'Spatial Analyst->Map Algebra->Raster Calculator
</pre>

<p>
Type in the expression for lsfac layer (make sure you have spaces around operators).<br>
Slope should be in radians,
flowaccumulation is in number of cells so we multiply by resolution:

<pre>
1.4 * (Power("Flowacc" * 1. / 22.1 , 0.4) * Power((Sin(("slope_1m" / 0.09 )* math.pi/180.0) ) , 1.2))
Set the output raster to lsfac
Click 'OK'
</pre>

<h4>Soil loss</h4>

Now build the expression for soil detachment rate E (soil loss) s_loss.
<p>
cfactb is the land cover factor (C), soils_kf is the soil erodibility (K).<br>
From ncrast.mdb add: cfactb (C) and soil factor soils_kf (K) to your project.<br>
Hint: hold down control key to select multiple layers.<br>
The rainfall factor (R) is set here to be 270.<br>
The prevention measures factor (P) is here taken to = 1.<br>
If the expression does not work try moving the constant to the end of expression.


<pre>
270.0 * "cfactb" * "lsfac" * "soils_kf"
Click 'OK'
</pre>

Adjust color table for the s_loss map - histogram equalized color ramp may be needed
<span class="question">Find average soil loss rate in the area from the s_loss map</span> (in Properties:Source).


<h3>USPED model</h3>
Compute net erosion and deposition as a divergence of sediment flow vector field.<br>
Note that custom color tables that cover entire range of values
including negative are important in this section.

<p>
We have already computed slope_1m and flowaccumulation, but we will also need direction of flow.<br>
Compute aspect_1m map (direction of flow, direction of gradient vector) using the Aspect function:

<pre>
Select 'Spatial Analyst Tools->Surface->Aspect'
Set 'Input' to 'e_lid792'
Set 'Output Raster Dataset' to '.\Assign12\aspect_1m'
keep DEGREES for units
Click 'OK'
</pre>

<p>
Build an expression for sflowtopo (topographic factor LS for sediment flow T)
using the Raster Calculator.<br>
For the exponents use m=n=1, resolution is 1.

<pre>
"Flowacc" * 1. * Sin("slope_1m" * math.pi/180.0)
output raster = sflowtopo
</pre>

<p>
OR use m=1.3 and n=1.2 for study areas with extensive rills.<br>
In this case, channels/streams will have large erosion rates due to high values of flowaccumulation.


<pre>
(Power("Flowacc" * 1. , 1.3) * Power((Sin("slope_1m" * math.pi/180.0)), 1.2))
output raster = sflowtopo
CLick "OK"
</pre>

<h4>Compute divergence of sediment flow</h3>
First compute components of sediment flow in x and y direction:

<pre>
Build an expression for: qsx
"sflowtopo" * "soils_kf" * "cfactb" * 270. * Cos((- "aspect_1m" + 450.) * math.pi / 180.0) 
Output raster = qsx
Click "OK"

Build an expression for: qsy
"sflowtopo" * "soils_kf" * "cfactb" * 270. * Sin((- "aspect_1m" + 450.) * math.pi / 180.0) 
Output raster = qsy
Click "OK"
</pre>

<p>
Compute components of change in sediment flow in x and y direction
as partial derivatives of sediment flow field, derived from slope and aspect
 - see eqs 1,2,3 from <a href="http://www4.ncsu.edu/~hmitaso/gmslab/reports/cerl99/rep99.html">here</a>.

<pre>
In ArcToolbox
Select 'Spatial Analyst Tools->Surface->Slope'
Set 'Input' to 'qsx'
Set 'Output Raster Dataset' to '.\Assign12\Slope_qsx'
Keep DEGREES for units
Click 'OK'
</pre>

<p>
Do the same for Aspect to compute Aspect_qsx:

<pre>
Select 'Spatial Analyst Tools->Surface->Aspect'
Set 'Input' to 'qsx'
Set 'Output Raster Dataset' to '.\Assign12\Aspect_qsx'
Click 'OK'

In ArcToolbox
Select 'Spatial Analyst Tools->Surface->Slope'
Set 'Input' to 'qsy'
Set 'Output Raster Dataset' to '.\Assign12\Slope_qsy'
Keep DEGREES for units
Click 'OK'
</pre>

<p>
Do the same for Aspect to compute Aspect_qsy:

<pre>
Select 'Spatial Analyst Tools->Surface->Aspect'
Set 'Input' to 'qsy'
Set 'Output Raster Dataset' to '.\Assign12\Aspect_qsy'
Click 'OK'

Using the 'Spatial Analyst->Map Algebra->Raster Calculator:
Build an expression for: qsx_dx
Cos((- "Aspect_qsx" + 450) * math.pi / 180.0) * Tan("Slope_qsx" * math.pi/180.0)
Click'OK'

Build an expression for: qsy_dy
Sin((- "Aspect_qsy" + 450) * math.pi / 180.0) * Tan("Slope_qsy" * math.pi/180.0)
Click 'OK'
</pre>

<p>
Finally. compute net erosion deposition:

<pre>
Build an expression for: erdep
"qsx_dx" + "qsy_dy"
Click 'OK'
</pre>

<p>
Assign an appropriate color classification scheme to the erdep raster and generate a map for the report.<br>

Note: the differences in the erdep are subtle and the default color table will almost assuredly render<br>
the erosion deposition map in a way that little detail is revealed. <br>
You are free to experiment with the the tools in Arc in order to define classification scheme which will
reveal the erosion/deposition pattern.<br>
Here's an option that should yield pretty good contrast between erosion and deposition:

<pre>
Open Layer Properties for the erdep layer
Under the Symbology tabâ€š
Select Classified from options (Unique Values, Classified, Stretched, Discrete) in the left column
Set Classes to 11
Choose a broad, divergent color ramp from the Color Ramp drop down field
that ranges from brown grading through white to green
Click on Classify
Edit the eleven break values (located in column on far right in Classification dialog to:
-250000.00  (data minimum)
-50.00
-5.00
-1.00
-0.10
0.10
1.00
5.00
50.00
330000.00    (data maximum)
Click OK
Click Apply
</pre>

You should now see the erosion and deposition areas rendered with pretty good contrast.
