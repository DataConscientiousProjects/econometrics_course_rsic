<h2>Geomorphometry I: Terrain Modeling</h2>
<p>Resources:
<a href="http://www.lib.ncsu.edu/gis/virtcamp.html">ESRI virtual campus</a>

Create the folder 'Assign8'.<br>
Download the file <a href="http://courses.ncsu.edu/mea582/common/GIS_anal_arc/lid_be_ptsarc.txt">lid_be_ptsarc.txt</a> to the Assign8 folder.

<p>
Set the output coordinate system and spatial extent to the layer
that you are working with from 'Geprocessing -> Environment'.<br>
For example, for the point cloud data analysis set it to raster e_lid792 
which is equivalent to 1m resolution rural_1m region in GRASS.

<h3>Analyze bare earth lidar data</h3>
<h4>Compute a raster map representing number of points per cell</h4>
Use the lidar input (point cloud) file: 'lid_be_ptsarc.txt'.

<pre>
Select Menu 'File -> Add Data -> Add XY Data'
Browse for data table:  ./Assign8//lid_be_ptsarc.txt
Set the 'X-Field' to X (this may happen automatically)
Set the 'Y-Field' to Y (this may happen automatically)
Set the 'Z-Field' to Z (this is  less likely to happen automatically)
Set the 'Coordinate system' to 'NAD 1983 State Plane North Carolina FIPS 3200'
Set the units to meter
Click 'OK'
Click 'OK'

NOTE: You will probably be presented with a 'Table Does Not Have Object-ID Field' warning. 
This is okay. Read the lengthy message so that you understand what it's trying to tell you 
(you'll rectify this in the next step) and then...
Click 'OK'
</pre>

<p>
Make this data permanent:

<pre>
RMC 'lid_be_ptsarc.txt Events' and Select 'Data -> Export Data...'
Set the 'Ouptu Feature Class' to '.\Assign8\lidar_be.shp'
Set 'Save as type' to 'Shapefile'
Click 'Save'
Click 'OK'
Click 'Yes' when prompted to add the data to the data frame as a layer
</pre>

<p>
Remove the event theme.

<pre>
RMC 'lid_be_ptsarc.txt Events' and Select 'Remove'
</pre>

<p>
Compute a raster map representing number of points per cell (at 2 different resolutions).<br>
Calculating for 2m x 2m cell:

<pre>
Open the ArcToolbox
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'lidar_be'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\bin_count2m'
Set 'Cell assignment type' to 'COUNT'
Set Cellsize' to '2'                            
Click 'OK'
</pre>

<p>
Calculate for 6m x 6m cell:

<pre>
Open the ArcToolbox (if not already open)
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'lidar_be'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\bin_count6m'
Set 'Cell assignment type' to 'COUNT'
Set Cellsize' to '6'                             
Click 'OK'
</pre>

<h4>Compute raster maps representing different elevation statistics for each cell</h4>
Compute mean:
<pre>
Open the ArcToolbox (if not already open)
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'lidar_be'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\bin_mean6m'
Set 'Cell assignment type' to 'MEAN'
Set Cellsize' to '6'                            
Click 'OK'
</pre>

<p>
Compute range:

<pre>
Open the ArcToolbox (if not already open)
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'lidar_be'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\bin_range6m'
Set 'Cell assignment type' to 'RANGE'
Set Cellsize' to '6'                            
Click 'OK'
</pre>

<p>
Compute variation (standard deviation):

<pre>
Open the ArcToolbox (if not already open)
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'lidar_be'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\bin_var6m'
Set 'Cell assignment type' to 'STANDARD_DEVIATION'
Set Cellsize' to '6'                            
Click 'OK'
</pre>

<p>
Find how many points are there:

<pre>
RMC 'lidar_be->Open Attribute Table'
</pre>

<h3>Analyze multiple return lidar data</h3>

Add some background data:

<pre>
Select Menu File -> Add Data -> Add Data...
Select ncshape.mdb/streets_wake
Select ncshape.mdb/lakes
Select ncshape.mdb/streams
</pre>

<p>
Display bare ground and multiple return points over orthophoto:

<pre>
Select Menu 'File -> Add Data -> Add Data...'
Select ncrast.mdb/ortho01
Select ncshape/elev_lidrural_mrpts

NOTE: if you receive a Coordinate System warning
read through the message, and then: Click 'Close'
</pre>

<p>
Select a subset of the lidar points for analysis:

<pre>
RMC 'elev_lidrural_mrpts->Zoom to Layer'
Select the 'Select Features by Rectange' tool (in the Select Tool dropdown menu in the Main toolbar)
RMC on 'lidar_be' in the TOC and select 'Selection -> Make This The Only Selectable Layer'
Drag a box that selects points from 'lidar_be' that overlap with 'elev_lidrural_mrpts'
NOTE: make sure that the layer 'lidar_be' is visible (checked on in TOC)
RMC 'lidar_be-> DAta -> Export Data...'
Set 'Output file' to '.\Assign8\rural_bepts.shp'
Click 'Save'
Click 'OK'
click 'Yes' to add the exported data to the map
Select Menu 'Selection->Clear Selected Features'
</pre>

<p>
Check the imported data by creating low resolution DEM:

<pre>
Open the ArcToolbox (if not already open)
Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'rural_bepts'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\be_rural6m'
Set 'Cell assignment type' to 'MEAN'
Set Cellsize' to '6'
Click 'OK'

Select 'Conversion Tools->To Raster->Point to Raster'
Set 'Input Features' to 'elev_lidrural_mrpts'
Set 'Value field' to 'Z'
Set 'Output Raster Dataset' to '.\Assign8\rural_mr6m'
Set 'Cell assignment type' to 'MEAN'
Set Cellsize' to '6'
Click 'OK'
</pre>

<p>
Interpolate DEM and DSM:

<pre>
Check out a Geostatistical Analyst Extension license
LMC View->Toolbars->Geostatistical Analyst
Select 'Geostatistical Analyst Toolbar->Geostatistical Wizard'
Under 'Deterministic Methods' select 'Radial Basis Function' 
Set 'Source Dataset' to 'rural_bepts'
Set 'Data Field' to 'Z'
Click 'Next'
Under 'General Properties->Kernel Functions' select 'Spline with Tension'
Click 'Finish'
To the Method Report Click 'OK'
</pre>

<p>
Find out where we have multiple returns:

<pre>
RMC 'elev_lidrural_mrpts->Properties'
Select 'Symbology' tab
Under 'Show' select 'Categories->Unique Values'
Set the 'Value Field' to 'RETURN'
Click the 'Add All Values' button
Choose a color ramp that's to your liking
Click 'OK'
</pre>

<p>
Select out 1st return:

<pre>
LMC Menu 'Selection->Select by Attributes'
Set 'Layer' to 'elev_lidrural_mrpts'
Set 'Method' to 'Create a new selection'
</pre>

<p>
Construct the SQL SELECT statement:

<pre>
Double click [Return]
click '='
Type in the value '1' so that the expression looks like '[Return] = 1'
Click 'OK'
RMC 'elev_lidrural_mrpts->Data->Export Data...'
Save the selection set to '.\Assign8\lidfirst.shp'
Click 'Yes' to add the exported data to the map
LMC Menu 'Selection->Clear Selected Features'
</pre>

<p>
Select out the 2nd return:

<pre>
LMC 'Selection->Select by Attributes'
Set 'Layer' to 'elev_lidrural_mrpts'
Set 'Method' to 'Create a new selection'
Double click [Return]
click '='
Type in the value '2' so that the expression looks like '[Return] = 2'
Click 'OK'
RMC 'elev_lidrural_mrpts->Data->Export Data'
Save the selection set to '.\Assign8\lidlast.shp'
Click 'Yes' to add the exported data to the map
LMC 'Selection->Clear Selected Features'
</pre>

<h3>Optional - display the multiple return data as points in ArcScene</h3>
Set the spatial extent to the raster elev.<br>
Generate contours with 10m and 3m interval:

<pre>
File->Add Data->Add Data...
Add ./ncrast.mdb/elev
Check out a Spatial Analyst Extension license
Open the ArcToolbox (if not already open)
Select 'Spatial Analyst Tools->Surface->Contour'
Set 'Input Raster' to 'elev'
Set 'Contour interval' to '10'
Set 'Base contour' as '0'
Set 'Z factor' to '1'
Save 'Output polyline features' as '.\Assign8\cont_10m.shp'
Click 'OK'

Select 'Spatial Analyst Tools->Surface->Contour'
Set 'Input Surface' to 'elev'
Set 'Contour interval' to '3'
Set 'Base contour' as '55'
Set 'Z factor' to '1'
Save 'Output Features' as '.\Assign8\cont_3m.shp'
</pre>

<h3>FYI: Handling LAS data in ArcGIS</h3>
<h4>1. LAS Datasets</h4>
To import LAS files into ArcGIS, run the Create LAS Dataset tool in the Data Management toolbox.
This will prompt you to load all of your LAS files and create a dataset from them.
You can then use the LAS Dataset to Raster tool in the Conversion toolbox to create a raster DEM.
See <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//015w00000057000000">ArcGIS help</a>.

<h4>2. Mosaics</h4>
You can also import LAS using the Add Rasters to Mosaic Dataset tool.
See <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#/Adding_lidar_data_to_a_mosaic_dataset/015w0000006q000000/">ArcGIS help</a>.

<h4>3. Terrains</h4>
The Terrain Wizard in ArcCatalog. Create a feature dataset inside a geodatabase.  
Import your LAS files using the LAS to Multipoint tool in the 3D Analyst.  
Save the multipoint feature class in your new feature dataset.  
Right click on the feature dataset and select New/Terrain to launch the Terrain Wizard.
See ArcGIS help <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//005v0000001p000000">here</a>
and <a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//005v00000002000000">here</a>. 
<p>
Try the <a href="http://courses.ncsu.edu/mea582/common/media/01/0793_016.las.zip">Raleigh las data:0793_016.las.zip</a>
 
